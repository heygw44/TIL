# 1장. HTTP 개관 — 상세 정리

## 1. HTTP의 목적과 범위

- **HTTP(Hypertext Transfer Protocol)** 는 웹에서 **클라이언트**와 **서버**가 **리소스(resource)** 를 교환하기 위한 **애플리케이션 계층 프로토콜**이다.
- HTTP는 다음을 정의한다.
  - 요청과 응답이 **어떤 형식의 메시지**로 표현되는지
  - 트랜잭션에서 **클라이언트와 서버가 어떤 순서로 상호작용**하는지
  - 리소스를 식별하기 위한 **URI 체계**

- HTTP는 일반적으로 **TCP** 위에서 동작하며, 신뢰성 있는 바이트 스트림을 이용해 메시지를 전송한다.

---

## 2. 웹의 기본 참여자

### 2.1 사용자 에이전트(User Agent)

- 사용자를 대신해 요청을 생성하고 응답을 처리하는 클라이언트 프로그램을 의미한다.
- 대표 예: 웹 브라우저.
- 브라우저는 한 페이지를 표시하기 위해 **여러 개의 리소스**(HTML, CSS, JS, 이미지 등)를 **연속적으로 요청**할 수 있다.

### 2.2 오리진 서버(Origin Server)

- 리소스가 원래 존재하는 서버를 의미한다.
- 요청을 해석하여 응답을 생성한다.
- 정적 파일을 그대로 제공할 수도 있고, 애플리케이션 로직으로 **동적으로 생성된 결과**를 제공할 수도 있다.

---

## 3. 리소스(Resource)

- 웹에서 다루는 대상은 “파일”에 한정되지 않으며, **식별 가능하고 전송 가능한 모든 것**을 포함한다.
- 예:
  - 정적: HTML 문서, 이미지, CSS, JS
  - 동적: 검색 결과 페이지, 개인화된 피드, API 응답(JSON 등)

### 3.1 표현(Representation)

- 클라이언트가 받는 것은 “리소스 자체”가 아니라 **리소스의 표현(표현 형태)** 이다.
- 동일 리소스가 상황에 따라 다른 표현으로 전달될 수 있다(형식, 언어, 인코딩 등).

### 3.2 미디어 타입(Media Type)

- 응답 본문이 어떤 형식인지 식별하기 위한 값이다.
- 일반적으로 `Content-Type` 헤더로 전달된다.
- 예: `text/html`, `image/jpeg`, `application/json`.

---

## 4. URI: 리소스 식별

- **URI(Uniform Resource Identifier)** 는 리소스를 식별하기 위한 표준 식별자이다.
- 웹에서 가장 흔한 URI 형태는 **URL**이다.

### 4.1 URL 구성 요소

- 일반 형식: `scheme://host:port/path?query#fragment`
- 구성 요소 의미:
  - **scheme**: 접근 방식(예: `http`, `https`)
  - **host**: 서버 호스트명 또는 IP
  - **port**: 서버가 수신 대기하는 포트(생략 시 기본값 사용)
  - **path**: 서버 내 리소스 경로
  - **query**: 추가 파라미터(선택)
  - **fragment**: 문서 내부 위치 식별(선택, 주로 클라이언트 측에서 사용)

### 4.2 URL이 제공하는 정보

- 클라이언트는 URL을 통해 다음을 결정한다.
  - 어떤 프로토콜을 사용할지(`http`/`https`)
  - 어떤 서버로 연결할지(host/port)
  - 서버에서 어떤 리소스를 요청할지(path/query)

---

## 5. HTTP 트랜잭션(Transaction): 요청과 응답

- HTTP의 기본 동작 단위는 **요청 메시지 + 응답 메시지**로 이루어진 트랜잭션이다.

### 5.1 트랜잭션의 일반 흐름

1. 클라이언트가 URL로부터 서버(host/port)를 결정한다.
2. 서버로 커넥션을 설정한다(일반적으로 TCP).
3. 클라이언트가 요청 메시지를 전송한다.
4. 서버가 요청을 처리하고 응답 메시지를 전송한다.
5. 커넥션을 종료하거나 재사용한다(정책에 따라 다름).

### 5.2 메서드(Method)

- 메서드는 요청이 수행하려는 동작을 나타낸다.
- 대표 메서드:
  - **GET**: 리소스 조회
  - **POST**: 데이터 전송 및 처리 요청
  - **PUT**: 리소스 생성 또는 전체 갱신
  - **DELETE**: 리소스 삭제
  - **HEAD**: 본문 없이 헤더만 요청(리소스 메타데이터 확인)

### 5.3 상태 코드(Status Code)

- 서버는 응답 상태 코드로 결과를 전달한다.
- 범주(의미 중심):
  - **2xx**: 요청이 성공적으로 처리됨
  - **3xx**: 리소스가 다른 위치로 이동했거나, 다른 조치가 필요함
  - **4xx**: 요청에 문제가 있음(잘못된 요청, 권한 부족, 존재하지 않음 등)
  - **5xx**: 서버가 요청을 정상 처리하지 못함

---

## 6. HTTP 메시지(Message)

- HTTP 메시지는 사람이 읽을 수 있는 텍스트 기반 형식이며, **시작줄**, **헤더**, **본문**으로 구성된다.

### 6.1 공통 구조

- **Start Line(시작줄)**: 메시지의 종류와 핵심 정보를 한 줄로 표현
- **Headers(헤더)**: 메시지의 속성(메타데이터)을 이름-값 쌍으로 나열
- **Body(본문, 선택)**: 전송할 실제 데이터(리소스 표현 또는 요청 데이터)

### 6.2 요청 메시지(Request Message)

- 시작줄 형식: `METHOD SP URI SP HTTP-VERSION`
- 의미:
  - METHOD: 동작(예: GET)
  - URI: 대상 리소스
  - HTTP-VERSION: 프로토콜 버전

- 헤더는 다음 정보를 담을 수 있다.
  - 서버 식별(예: Host)
  - 클라이언트가 수용 가능한 타입(예: Accept)
  - 인증/세션 관련 정보(상황에 따라)

- 본문은 주로 POST/PUT 등에서 사용된다.

### 6.3 응답 메시지(Response Message)

- 시작줄 형식: `HTTP-VERSION SP STATUS-CODE SP REASON-PHRASE`
- 의미:
  - STATUS-CODE: 처리 결과
  - REASON-PHRASE: 사람이 읽기 위한 설명(동작 자체는 코드가 결정)

- 헤더는 다음 정보를 담을 수 있다.
  - 본문 형식(예: Content-Type)
  - 본문 길이(예: Content-Length)
  - 캐시 관련 지시(예: Cache-Control)

- 본문에는 리소스의 표현(HTML/이미지/JSON 등)이 포함될 수 있다.

### 6.4 헤더의 역할을 이해하는 기준

- 헤더는 “본문을 어떻게 해석하고 처리할지”를 명확히 하기 위한 제어/설명 정보이다.
- 실제 동작은 다음과 같이 구분해 이해하면 된다.
  - **표현 관련**: 본문의 타입/길이/인코딩
  - **요청 조건**: 클라이언트가 원하는 형식, 조건부 요청 등
  - **전송/연결 관련**: 커넥션 처리, 재사용 여부
  - **캐시 관련**: 저장 가능 여부, 재검증 방식

---

## 7. 커넥션(Connection)

- 커넥션은 HTTP 메시지를 전송하는 통로이다.
- HTTP 자체는 “전송 방식”을 강제하지 않지만, 일반적으로 다음 특징을 고려한다.
  - 커넥션을 새로 만드는 비용(지연)이 존재한다.
  - 여러 요청을 처리할 때 커넥션을 재사용하면 지연을 줄일 수 있다.

---

## 8. 중개자(Intermediaries)

- 웹 트래픽은 클라이언트와 오리진 서버 사이에 다양한 중개자가 개입할 수 있다.

### 8.1 프록시(Proxy)

- 클라이언트와 서버 사이에서 요청/응답을 전달하는 중개자.
- 용도:
  - 접근 제어 및 정책 적용
  - 로깅 및 감시
  - 보안 필터링

### 8.2 캐시(Cache)

- 이전 응답을 저장해 두고 동일하거나 유사한 요청에 재사용하는 구성 요소.
- 목적:
  - 응답 시간 감소
  - 네트워크 사용량 감소
  - 오리진 서버 부하 완화

### 8.3 게이트웨이(Gateway)

- HTTP 요청을 받아 내부적으로 다른 프로토콜/서비스로 연결하거나 변환하는 중개자.
- 클라이언트 입장에서는 HTTP 서버처럼 보일 수 있다.

### 8.4 터널(Tunnel)

- 중간 장비가 메시지 내용을 해석하지 않고, 특정 트래픽을 그대로 전달하기 위한 경로.

### 8.5 에이전트(Agent)

- 사용자를 대신해 HTTP 요청을 수행하는 프로그램을 의미한다.
- 브라우저도 대표적인 에이전트이며, 자동화된 프로그램도 포함된다.

---

## 9. 요약

- HTTP는 웹에서 리소스를 교환하기 위한 요청/응답 기반 프로토콜이다.
- 리소스는 URI로 식별되며, 트랜잭션은 메서드와 상태 코드로 표현된다.
- 메시지는 시작줄, 헤더, 본문으로 구성되며, 일반적으로 TCP 커넥션을 통해 전송된다.
- 프록시, 캐시, 게이트웨이, 터널, 에이전트 등의 중개자가 트래픽 전달과 최적화에 관여할 수 있다.
